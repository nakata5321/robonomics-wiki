{"hash":"069e8bfd112976188d1110eda84b5a45b6120984","data":{"doc":{"id":"7f2f306ea9fed4dc72ccdc42d44842b2","title":"Connect Vacuum Cleaner","contributors":["LoSk-p","dergudzon","Leemo94"],"translated":false,"headings":[],"subtitles":[{"depth":2,"value":"Connect to Home Assistant","anchor":"#connect-to-home-assistant"}],"content":"\n## Connect to Home Assistant\n\nYou need your vacuum to be connected to Mi Home app. If you haven't done this yet press `+` button on the top right corner, find your vacuum (it must be in connecting mode via a long press of the power button) and follow instructions in the app. For more details look at the user manual of your vacuum.\n\nOpen Home Assistant web page with this address:\n```\nhttp://<raspberry_address>:8123\n```\n\nGo to `Integrations` tab, press `Add integration` and choose `Xiaomi Miio`:\n\n![integration](../images/home-assistant/integration.png)\n\nThen fill your username (or phone) and password from Mi Home account and choose your country server:\n\n![auth](../images/home-assistant/auth.png)\n\nPress `Submit` and choose your Vacuum (Robot vacuum in this example):\n\n![vacuum](../images/home-assistant/vacuum_int.png)\n\nThen we need to setup action to control Vacuum through Robonomics. For that open a configuration file on your raspberry pi:\n\n```bash\nnano ~/.homeassistant/configuration.yaml\n```\n\nAnd add following to the end of the file (full config file you can find [here](https://github.com/airalab/robonomics-smarthome/blob/main/configuration.yaml)):\n\n```yaml\nautomation:\n  - alias: \"vacuum_start\"\n    trigger:\n      platform: webhook\n      webhook_id: \"vacuum_start\"\n    action:\n      service: vacuum.start\n      target:\n        entity_id:\n          - vacuum.robot_vacuum\n\n  - alias: \"vacuum_pause\"\n    trigger:\n      platform: webhook\n      webhook_id: \"vacuum_pause\"\n    action:\n      service: vacuum.pause\n      target:\n        entity_id:\n          - vacuum.robot_vacuum\n\n  - alias: \"vacuum_return_to_base\"\n    trigger:\n      platform: webhook\n      webhook_id: \"vacuum_return_to_base\"\n    action:\n      service: vacuum.return_to_base\n      target:\n        entity_id:\n          - vacuum.robot_vacuum\n```\nAnd restart Home Assistant:\n```bash\nsystemctl restart home-sistant@homeassistant.service\n```\n\nNow you can create datalog in your account to command robot to Start Cleaning, to Pause or to Return to Base. The message must be encrypted. you can send encrypted message with [send_datalog.py](https://github.com/airalab/robonomics-smarthome/blob/main/python_scripts/send_datalog.py) script that you used in [Raspberry Setup](/docs/raspberry_setup) page.\nRun the script in a new terminal with message to start cleaning:\n```bash\ncd /srv/homeassistant/python_scripts\nsource /srv/homeassistant/bin/activate\npython3 send_datalog.py \"{ \\\"agent\\\" : \\\"vacuum_start\\\" }\"\n```\nto pause:\n```bash\ncd /srv/homeassistant/python_scripts\nsource /srv/homeassistant/bin/activate\npython3 send_datalog.py \"{ \\\"agent\\\" : \\\"vacuum_pause\\\" }\"\n```\nto return to base:\n```bash\ncd /srv/homeassistant/python_scripts\nsource /srv/homeassistant/bin/activate\npython3 send_datalog.py \"{ \\\"agent\\\" : \\\"vacuum_return_to_base\\\" }\"\n```\n"}},"context":{}}